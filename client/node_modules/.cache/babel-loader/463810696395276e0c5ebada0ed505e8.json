{"ast":null,"code":"var request = require('request');\n\nvar parseString = require('xml2js').parseString;\n\nvar fs = require('fs');\n\nvar api = require('./api');\n\nmodule.exports = function (anime) {\n  anime.login = function (username, password, callback) {\n    var self = this;\n    var ret = {\n      success: true,\n      username: '',\n      id: '',\n      message: ''\n    };\n    request({\n      'url': api['VERIFY_CREDENTIALS'],\n      'headers': {\n        'User-Agent': api['USER_AGENT']\n      },\n      'auth': {\n        'user': username,\n        'pass': password,\n        'sendImmediately': true\n      }\n    }, function (error, response, body) {\n      if (!error && response.statusCode === 200) {\n        saveLogin(username, password, function (err) {\n          if (err) {\n            ret.success = false;\n            ret.message = 'Credentials could not be saved';\n            callback(ret);\n          } else {\n            parseString(body, function (err, result) {\n              ret.username = result.user.username[0];\n              ret.id = result.user.id[0];\n              callback(ret);\n            });\n          }\n        });\n      } else {\n        ret.success = false;\n        ret.message = 'Credentials not valid';\n        callback(ret);\n      }\n    });\n  };\n\n  anime.logout = function (callback) {\n    removeLogin(callback);\n  };\n\n  anime.retrieveLogin = function (callback) {\n    fs.readFile(getAuthFile(), function (err, data) {\n      var json = {};\n\n      if (!err) {\n        json = JSON.parse(data);\n      }\n\n      callback(err, json);\n    });\n  };\n\n  function saveLogin(username, password, callback) {\n    var json = JSON.stringify({\n      'username': username,\n      'password': password\n    });\n    fs.writeFile(getAuthFile(), json, function (err) {\n      callback(err);\n    });\n  }\n\n  function removeLogin(callback) {\n    fs.unlink(getAuthFile(), callback);\n  }\n\n  function getAuthFile() {\n    var home = process.env[process.platform == 'win32' ? 'USERPROFILE' : 'HOME'];\n    return home + '/.anime';\n  }\n};","map":{"version":3,"sources":["/home/ramon/Documentos/web/react/blog-data-science/node_modules/anime/auth.js"],"names":["request","require","parseString","fs","api","module","exports","anime","login","username","password","callback","self","ret","success","id","message","error","response","body","statusCode","saveLogin","err","result","user","logout","removeLogin","retrieveLogin","readFile","getAuthFile","data","json","JSON","parse","stringify","writeFile","unlink","home","process","env","platform"],"mappings":"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","sourcesContent":["var request = require('request');\nvar parseString = require('xml2js').parseString;\nvar fs = require('fs');\n\nvar api = require('./api');\n\nmodule.exports = function(anime) {\n    anime.login = function(username, password, callback) {\n        var self = this;\n        var ret = {\n            success: true,\n            username: '',\n            id: '',\n            message: ''\n        };\n\n        request({\n            'url': api['VERIFY_CREDENTIALS'],\n            'headers': {\n                'User-Agent': api['USER_AGENT']\n            },\n            'auth': {\n                'user': username,\n                'pass': password,\n                'sendImmediately': true\n            }\n        }, function(error, response, body) {\n            if (!error && response.statusCode === 200) {\n                saveLogin(username, password, function(err) {\n                    if (err) {\n                        ret.success = false;\n                        ret.message = 'Credentials could not be saved';\n\n                        callback(ret);\n                    } else {\n                        parseString(body, function(err, result) {\n                            ret.username = result.user.username[0];\n                            ret.id = result.user.id[0];\n\n                            callback(ret);\n                        });\n                    }\n                });\n            } else {\n                ret.success = false;\n                ret.message = 'Credentials not valid'\n\n                callback(ret);\n            }\n        });\n    };\n\n    anime.logout = function(callback) {\n        removeLogin(callback);\n    };\n\n    anime.retrieveLogin = function(callback) {\n        fs.readFile(getAuthFile(), function(err, data) {\n            var json = {};\n            if (!err) {\n                json = JSON.parse(data);\n            }\n\n            callback(err, json);\n        });\n    };\n\n    function saveLogin(username, password, callback) {\n        var json = JSON.stringify({\n            'username': username,\n            'password': password\n        });\n        fs.writeFile(getAuthFile(), json, function(err) {\n            callback(err);\n        });\n    }\n\n    function removeLogin(callback) {\n        fs.unlink(getAuthFile(), callback);\n    }\n\n    function getAuthFile() {\n        var home = process.env[(process.platform == 'win32') ? 'USERPROFILE' : 'HOME'];\n        return home + '/.anime';\n    }\n};"]},"metadata":{},"sourceType":"script"}