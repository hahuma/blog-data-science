{"ast":null,"code":"const findCacheDir = require('find-cache-dir');\n\nconst Git = require('./git');\n\nconst filenamify = require('filenamify-url');\n\nconst copy = require('./util').copy;\n\nconst getUser = require('./util').getUser;\n\nconst fs = require('fs-extra');\n\nconst globby = require('globby');\n\nconst path = require('path');\n\nconst util = require('util');\n\nconst log = util.debuglog('gh-pages');\n\nfunction getCacheDir() {\n  return findCacheDir({\n    name: 'gh-pages'\n  });\n}\n\nfunction getRepo(options) {\n  if (options.repo) {\n    return Promise.resolve(options.repo);\n  } else {\n    const git = new Git(process.cwd(), options.git);\n    return git.getRemoteUrl(options.remote);\n  }\n}\n\nexports.defaults = {\n  dest: '.',\n  add: false,\n  git: 'git',\n  depth: 1,\n  dotfiles: false,\n  branch: 'gh-pages',\n  remote: 'origin',\n  src: '**/*',\n  remove: '.',\n  push: true,\n  history: true,\n  message: 'Updates',\n  silent: false\n};\n/**\n * Push a git branch to a remote (pushes gh-pages by default).\n * @param {string} basePath The base path.\n * @param {Object} config Publish options.\n * @param {Function} callback Callback.\n */\n\nexports.publish = function publish(basePath, config, callback) {\n  if (typeof config === 'function') {\n    callback = config;\n    config = {};\n  }\n\n  const options = Object.assign({}, exports.defaults, config); // For backward compatibility before fixing #334\n\n  if (options.only) {\n    options.remove = options.only;\n  }\n\n  if (!callback) {\n    callback = function (err) {\n      if (err) {\n        log(err.message);\n      }\n    };\n  }\n\n  function done(err) {\n    try {\n      callback(err);\n    } catch (err2) {\n      log('Publish callback threw: %s', err2.message);\n    }\n  }\n\n  try {\n    if (!fs.statSync(basePath).isDirectory()) {\n      done(new Error('The \"base\" option must be an existing directory'));\n      return;\n    }\n  } catch (err) {\n    done(err);\n    return;\n  }\n\n  const files = globby.sync(options.src, {\n    cwd: basePath,\n    dot: options.dotfiles\n  }).filter(file => {\n    return !fs.statSync(path.join(basePath, file)).isDirectory();\n  });\n\n  if (!Array.isArray(files) || files.length === 0) {\n    done(new Error('The pattern in the \"src\" property didn\\'t match any files.'));\n    return;\n  }\n\n  let repoUrl;\n  let userPromise;\n\n  if (options.user) {\n    userPromise = Promise.resolve(options.user);\n  } else {\n    userPromise = getUser();\n  }\n\n  return userPromise.then(user => getRepo(options).then(repo => {\n    repoUrl = repo;\n    const clone = path.join(getCacheDir(), filenamify(repo));\n    log('Cloning %s into %s', repo, clone);\n    return Git.clone(repo, clone, options.branch, options);\n  }).then(git => {\n    return git.getRemoteUrl(options.remote).then(url => {\n      if (url !== repoUrl) {\n        const message = 'Remote url mismatch.  Got \"' + url + '\" ' + 'but expected \"' + repoUrl + '\" in ' + git.cwd + '.  Try running the `gh-pages-clean` script first.';\n        throw new Error(message);\n      }\n\n      return git;\n    });\n  }).then(git => {\n    // only required if someone mucks with the checkout between builds\n    log('Cleaning');\n    return git.clean();\n  }).then(git => {\n    log('Fetching %s', options.remote);\n    return git.fetch(options.remote);\n  }).then(git => {\n    log('Checking out %s/%s ', options.remote, options.branch);\n    return git.checkout(options.remote, options.branch);\n  }).then(git => {\n    if (!options.history) {\n      return git.deleteRef(options.branch);\n    } else {\n      return git;\n    }\n  }).then(git => {\n    if (options.add) {\n      return git;\n    }\n\n    log('Removing files');\n    const files = globby.sync(options.remove, {\n      cwd: path.join(git.cwd, options.dest)\n    }).map(file => path.join(options.dest, file));\n\n    if (files.length > 0) {\n      return git.rm(files);\n    } else {\n      return git;\n    }\n  }).then(git => {\n    log('Copying files');\n    return copy(files, basePath, path.join(git.cwd, options.dest)).then(function () {\n      return git;\n    });\n  }).then(git => {\n    return Promise.resolve(options.beforeAdd && options.beforeAdd(git)).then(() => git);\n  }).then(git => {\n    log('Adding all');\n    return git.add('.');\n  }).then(git => {\n    if (!user) {\n      return git;\n    }\n\n    return git.exec('config', 'user.email', user.email).then(() => {\n      if (!user.name) {\n        return git;\n      }\n\n      return git.exec('config', 'user.name', user.name);\n    });\n  }).then(git => {\n    log('Committing');\n    return git.commit(options.message);\n  }).then(git => {\n    if (options.tag) {\n      log('Tagging');\n      return git.tag(options.tag).catch(error => {\n        // tagging failed probably because this tag alredy exists\n        log(error);\n        log('Tagging failed, continuing');\n        return git;\n      });\n    } else {\n      return git;\n    }\n  }).then(git => {\n    if (options.push) {\n      log('Pushing');\n      return git.push(options.remote, options.branch, !options.history);\n    } else {\n      return git;\n    }\n  }).then(() => done(), error => {\n    if (options.silent) {\n      error = new Error('Unspecified error (run without silent option for detail)');\n    }\n\n    done(error);\n  }));\n};\n/**\n * Clean the cache directory.\n */\n\n\nexports.clean = function clean() {\n  fs.removeSync(getCacheDir());\n};","map":{"version":3,"sources":["/home/ramon/Documentos/web/react/blog-data-science/node_modules/gh-pages/lib/index.js"],"names":["findCacheDir","require","Git","filenamify","copy","getUser","fs","globby","path","util","log","debuglog","getCacheDir","name","getRepo","options","repo","Promise","resolve","git","process","cwd","getRemoteUrl","remote","exports","defaults","dest","add","depth","dotfiles","branch","src","remove","push","history","message","silent","publish","basePath","config","callback","Object","assign","only","err","done","err2","statSync","isDirectory","Error","files","sync","dot","filter","file","join","Array","isArray","length","repoUrl","userPromise","user","then","clone","url","clean","fetch","checkout","deleteRef","map","rm","beforeAdd","exec","email","commit","tag","catch","error","removeSync"],"mappings":"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","sourcesContent":["const findCacheDir = require('find-cache-dir');\nconst Git = require('./git');\nconst filenamify = require('filenamify-url');\nconst copy = require('./util').copy;\nconst getUser = require('./util').getUser;\nconst fs = require('fs-extra');\nconst globby = require('globby');\nconst path = require('path');\nconst util = require('util');\n\nconst log = util.debuglog('gh-pages');\n\nfunction getCacheDir() {\n  return findCacheDir({name: 'gh-pages'});\n}\n\nfunction getRepo(options) {\n  if (options.repo) {\n    return Promise.resolve(options.repo);\n  } else {\n    const git = new Git(process.cwd(), options.git);\n    return git.getRemoteUrl(options.remote);\n  }\n}\n\nexports.defaults = {\n  dest: '.',\n  add: false,\n  git: 'git',\n  depth: 1,\n  dotfiles: false,\n  branch: 'gh-pages',\n  remote: 'origin',\n  src: '**/*',\n  remove: '.',\n  push: true,\n  history: true,\n  message: 'Updates',\n  silent: false\n};\n\n/**\n * Push a git branch to a remote (pushes gh-pages by default).\n * @param {string} basePath The base path.\n * @param {Object} config Publish options.\n * @param {Function} callback Callback.\n */\nexports.publish = function publish(basePath, config, callback) {\n  if (typeof config === 'function') {\n    callback = config;\n    config = {};\n  }\n\n  const options = Object.assign({}, exports.defaults, config);\n\n  // For backward compatibility before fixing #334\n  if (options.only) {\n    options.remove = options.only;\n  }\n\n  if (!callback) {\n    callback = function(err) {\n      if (err) {\n        log(err.message);\n      }\n    };\n  }\n\n  function done(err) {\n    try {\n      callback(err);\n    } catch (err2) {\n      log('Publish callback threw: %s', err2.message);\n    }\n  }\n\n  try {\n    if (!fs.statSync(basePath).isDirectory()) {\n      done(new Error('The \"base\" option must be an existing directory'));\n      return;\n    }\n  } catch (err) {\n    done(err);\n    return;\n  }\n\n  const files = globby\n    .sync(options.src, {\n      cwd: basePath,\n      dot: options.dotfiles\n    })\n    .filter(file => {\n      return !fs.statSync(path.join(basePath, file)).isDirectory();\n    });\n\n  if (!Array.isArray(files) || files.length === 0) {\n    done(\n      new Error('The pattern in the \"src\" property didn\\'t match any files.')\n    );\n    return;\n  }\n\n  let repoUrl;\n  let userPromise;\n  if (options.user) {\n    userPromise = Promise.resolve(options.user);\n  } else {\n    userPromise = getUser();\n  }\n  return userPromise.then(user =>\n    getRepo(options)\n      .then(repo => {\n        repoUrl = repo;\n        const clone = path.join(getCacheDir(), filenamify(repo));\n        log('Cloning %s into %s', repo, clone);\n        return Git.clone(repo, clone, options.branch, options);\n      })\n      .then(git => {\n        return git.getRemoteUrl(options.remote).then(url => {\n          if (url !== repoUrl) {\n            const message =\n              'Remote url mismatch.  Got \"' +\n              url +\n              '\" ' +\n              'but expected \"' +\n              repoUrl +\n              '\" in ' +\n              git.cwd +\n              '.  Try running the `gh-pages-clean` script first.';\n            throw new Error(message);\n          }\n          return git;\n        });\n      })\n      .then(git => {\n        // only required if someone mucks with the checkout between builds\n        log('Cleaning');\n        return git.clean();\n      })\n      .then(git => {\n        log('Fetching %s', options.remote);\n        return git.fetch(options.remote);\n      })\n      .then(git => {\n        log('Checking out %s/%s ', options.remote, options.branch);\n        return git.checkout(options.remote, options.branch);\n      })\n      .then(git => {\n        if (!options.history) {\n          return git.deleteRef(options.branch);\n        } else {\n          return git;\n        }\n      })\n      .then(git => {\n        if (options.add) {\n          return git;\n        }\n\n        log('Removing files');\n        const files = globby\n          .sync(options.remove, {\n            cwd: path.join(git.cwd, options.dest)\n          })\n          .map(file => path.join(options.dest, file));\n        if (files.length > 0) {\n          return git.rm(files);\n        } else {\n          return git;\n        }\n      })\n      .then(git => {\n        log('Copying files');\n        return copy(files, basePath, path.join(git.cwd, options.dest)).then(\n          function() {\n            return git;\n          }\n        );\n      })\n      .then(git => {\n        return Promise.resolve(\n          options.beforeAdd && options.beforeAdd(git)\n        ).then(() => git);\n      })\n      .then(git => {\n        log('Adding all');\n        return git.add('.');\n      })\n      .then(git => {\n        if (!user) {\n          return git;\n        }\n        return git.exec('config', 'user.email', user.email).then(() => {\n          if (!user.name) {\n            return git;\n          }\n          return git.exec('config', 'user.name', user.name);\n        });\n      })\n      .then(git => {\n        log('Committing');\n        return git.commit(options.message);\n      })\n      .then(git => {\n        if (options.tag) {\n          log('Tagging');\n          return git.tag(options.tag).catch(error => {\n            // tagging failed probably because this tag alredy exists\n            log(error);\n            log('Tagging failed, continuing');\n            return git;\n          });\n        } else {\n          return git;\n        }\n      })\n      .then(git => {\n        if (options.push) {\n          log('Pushing');\n          return git.push(options.remote, options.branch, !options.history);\n        } else {\n          return git;\n        }\n      })\n      .then(\n        () => done(),\n        error => {\n          if (options.silent) {\n            error = new Error(\n              'Unspecified error (run without silent option for detail)'\n            );\n          }\n          done(error);\n        }\n      )\n  );\n};\n\n/**\n * Clean the cache directory.\n */\nexports.clean = function clean() {\n  fs.removeSync(getCacheDir());\n};\n"]},"metadata":{},"sourceType":"script"}